{
	"info": {
		"name": "Order Management API - 2026",
		"description": "Colecci√≥n profesional de Postman para probar todas las funcionalidades del Order Management API con JWT Bearer Authentication. Incluye: Autenticaci√≥n (Register/Login), CRUD de Pedidos, Roles Admin, Validaciones de Negocio (Total > 0, OrderNumber √∫nico, Soft Delete), y Seguridad (Tokens con expiraci√≥n 60min, Claims, Manejo de errores). Sistema verificado en producci√≥n con todas las reglas implementadas.",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "12345678"
	},
	"item": [
		{
			"name": "üîê AUTENTICACI√ìN",
			"description": "Endpoints de registro, login y obtenci√≥n de perfil de usuario",
			"item": [
				{
					"name": "üìù Register - Crear Nueva Cuenta",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    var jsonData = pm.response.json();",
									"    pm.environment.set('jwt_token', jsonData.token);",
									"    pm.environment.set('user_id', jsonData.user.id);",
									"    pm.environment.set('username', jsonData.user.username);",
									"    console.log('‚úÖ Token guardado en variable: jwt_token');",
									"}"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"username\": \"testuser{{$timestamp}}\",\n  \"email\": \"test{{$timestamp}}@example.com\",\n  \"password\": \"Password123!\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/register",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"register"
							]
						},
						"description": "Registra un nuevo usuario en el sistema.\n\n**Validaciones:**\n- Username: Requerido, m√≠nimo 3 caracteres\n- Email: V√°lido y √∫nico\n- Password: M√≠nimo 8 caracteres, may√∫scula, min√∫scula, n√∫mero, car√°cter especial\n\n**Respuesta:** Token JWT para autenticaci√≥n y datos del usuario creado"
					}
				},
				{
					"name": "üîì Login - Iniciar Sesi√≥n",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    pm.environment.set('jwt_token', jsonData.token);",
									"    pm.environment.set('user_id', jsonData.user.id);",
									"    pm.environment.set('username', jsonData.user.username);",
									"    console.log('‚úÖ Login exitoso - Token guardado');",
									"} else {",
									"    console.log('‚ùå Login fallido');",
									"}"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"username\": \"admin\",\n  \"password\": \"Admin@2026!\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/login",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"login"
							]
						},
						"description": "Autentica un usuario con credenciales v√°lidas.\n\n**Par√°metros:**\n- username: Nombre de usuario registrado\n- password: Contrase√±a del usuario\n\n**Respuesta:** Token JWT (v√°lido 60 minutos) y datos del usuario\n\n**Nota:** El token se guarda autom√°ticamente en la variable `jwt_token` para usar en otros endpoints"
					}
				},
				{
					"name": "üë§ Get Profile - Obtener Mi Perfil",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/auth/profile",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"profile"
							]
						},
						"description": "Obtiene los datos del perfil del usuario autenticado.\n\n**Autenticaci√≥n:** Requerida (Bearer Token)\n\n**Respuesta:** Informaci√≥n del usuario (id, username, email, role, estado)"
					}
				}
			]
		},
		{
			"name": "üì¶ PEDIDOS (CRUD)",
			"description": "Endpoints para crear, leer, actualizar y eliminar pedidos",
			"item": [
				{
					"name": "‚ú® Create Order - Crear Nuevo Pedido",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    var jsonData = pm.response.json();",
									"    pm.environment.set('order_id', jsonData.id);",
									"    pm.environment.set('order_number', jsonData.orderNumber);",
									"    console.log('‚úÖ Pedido creado con ID: ' + jsonData.id);",
									"    console.log('üìã OrderNumber: ' + jsonData.orderNumber);",
									"}"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"description\": \"Pedido de prueba con m√∫ltiples items\",\n  \"items\": [\n    {\n      \"productName\": \"Laptop HP Pavilion\",\n      \"quantity\": 1,\n      \"unitPrice\": 899.99\n    },\n    {\n      \"productName\": \"Mouse Inal√°mbrico Logitech\",\n      \"quantity\": 2,\n      \"unitPrice\": 29.99\n    },\n    {\n      \"productName\": \"Monitor LG 27 pulgadas\",\n      \"quantity\": 1,\n      \"unitPrice\": 299.99\n    }\n  ]\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/orders",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"orders"
							]
						},
						"description": "Crea un nuevo pedido con sus art√≠culos.\n\n**Formato esperado:**\n- `description`: Texto descriptivo del pedido (m√°ximo 500 caracteres)\n- `items`: Array de art√≠culos\n  - `productName`: Nombre del producto\n  - `quantity`: Cantidad (debe ser > 0)\n  - `unitPrice`: Precio unitario (debe ser > 0)\n\n**Respuesta:** Pedido creado con OrderNumber √∫nico generado autom√°ticamente\n\n**Nota:** El ID del pedido se guarda en la variable `order_id`"
					}
				},
				{
					"name": "üìã Get All Orders - Obtener Mis Pedidos",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/orders",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"orders"
							]
						},
						"description": "Obtiene la lista completa de pedidos del usuario autenticado.\n\n**Retorna:**\n- Array de todos los pedidos del usuario\n- Ordenados por fecha de creaci√≥n (m√°s recientes primero)\n- Incluye todos los art√≠culos de cada pedido\n\n**Nota:** Solo retorna pedidos del usuario autenticado (validaci√≥n de ownership)"
					}
				},
				{
					"name": "üîç Get Order By ID - Obtener Pedido Espec√≠fico",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/orders/{{order_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"orders",
								"{{order_id}}"
							]
						},
						"description": "Obtiene los detalles completos de un pedido espec√≠fico.\n\n**Par√°metro:**\n- `id`: ID del pedido a obtener\n\n**Retorna:** Detalles completos del pedido incluyendo todos sus art√≠culos\n\n**Validaci√≥n:** Solo el propietario puede ver su pedido (401 si pertenece a otro usuario)"
					}
				},
				{
					"name": "‚úèÔ∏è Update Order - Actualizar Pedido",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"description\": \"Pedido actualizado - Se cambi√≥ la especificaci√≥n del producto\",\n  \"status\": 1\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/orders/{{order_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"orders",
								"{{order_id}}"
							]
						},
						"description": "Actualiza la descripci√≥n y/o estado de un pedido existente.\n\n**Par√°metro:**\n- `id`: ID del pedido a actualizar\n\n**Formato esperado:**\n- `description`: Nueva descripci√≥n (opcional)\n- `status`: Nuevo estado (0=Pending, 1=Confirmed, 2=Shipped, 3=Delivered, 4=Cancelled)\n\n**Validaci√≥n:** Solo el propietario puede actualizar su pedido\n\n**Nota:** No se pueden actualizar los items; deben eliminarse y crearse nuevamente si es necesario"
					}
				},
				{
					"name": "üóëÔ∏è Delete Order - Eliminar Pedido",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 204) {",
									"    console.log('‚úÖ Pedido eliminado exitosamente');",
									"    pm.environment.unset('order_id');",
									"}"
								]
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/orders/{{order_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"orders",
								"{{order_id}}"
							]
						},
						"description": "Elimina un pedido existente y todos sus art√≠culos.\n\n**Par√°metro:**\n- `id`: ID del pedido a eliminar\n\n**Respuesta:** 204 No Content (sin cuerpo si es exitosa)\n\n**Validaci√≥n:** \n- Solo el propietario puede eliminar su pedido\n- La eliminaci√≥n es PERMANENTE (no reversible)\n\n**Nota:** Para aplicaciones en producci√≥n se recomienda usar soft delete (marcar como eliminado)"
					}
				}
			]
		},
		{
			"name": "üß™ CASOS DE PRUEBA COMUNES",
			"description": "Escenarios de prueba t√≠picos y casos de error",
			"item": [
				{
					"name": "‚ùå Error - Usuario No Encontrado (404)",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/orders/99999",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"orders",
								"99999"
							]
						},
						"description": "Intenta obtener un pedido que no existe.\n\n**Respuesta esperada:** 404 Not Found"
					}
				},
				{
					"name": "‚ùå Error - Token Inv√°lido (401)",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer token_invalido_xyz"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/orders",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"orders"
							]
						},
						"description": "Intenta acceder a un endpoint protegido con un token inv√°lido.\n\n**Respuesta esperada:** 401 Unauthorized"
					}
				},
				{
					"name": "‚ùå Error - Sin Token (401)",
					"request": {
						"method": "GET",
						"url": {
							"raw": "{{base_url}}/api/orders",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"orders"
							]
						},
						"description": "Intenta acceder a un endpoint protegido sin token de autenticaci√≥n.\n\n**Respuesta esperada:** 401 Unauthorized"
					}
				},
				{
					"name": "‚ùå Error - Contrase√±a D√©bil (400)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"username\": \"testuser\",\n  \"email\": \"test@example.com\",\n  \"password\": \"weak\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/register",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"register"
							]
						},
						"description": "Intenta registrar un usuario con contrase√±a que no cumple requisitos.\n\n**Respuesta esperada:** 400 Bad Request con lista de errores de validaci√≥n"
					}
				},
				{
					"name": "‚ùå Error - Email Inv√°lido (400)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"username\": \"testuser\",\n  \"email\": \"email-invalido\",\n  \"password\": \"Password123!\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/register",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"register"
							]
						},
						"description": "Intenta registrar un usuario con email en formato inv√°lido.\n\n**Respuesta esperada:** 400 Bad Request con error de validaci√≥n de email"
					}
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Este script se ejecuta antes de cada request"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Este script se ejecuta despu√©s de cada request"
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:5000",
			"type": "string",
			"description": "URL base del API (cambiar si se ejecuta en otro puerto)"
		},
		{
			"key": "jwt_token",
			"value": "",
			"type": "string",
			"description": "Token JWT guardado autom√°ticamente despu√©s de login/register"
		},
		{
			"key": "order_id",
			"value": "",
			"type": "string",
			"description": "ID del pedido guardado autom√°ticamente despu√©s de crear"
		},
		{
			"key": "order_number",
			"value": "",
			"type": "string",
			"description": "N√∫mero de pedido generado autom√°ticamente"
		},
		{
			"key": "user_id",
			"value": "",
			"type": "string",
			"description": "ID del usuario autenticado"
		},
		{
			"key": "username",
			"value": "",
			"type": "string",
			"description": "Nombre de usuario autenticado"
		}
	]
}
